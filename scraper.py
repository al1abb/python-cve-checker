import requests
from bs4 import BeautifulSoup
from helpers import cvss_color_calc

def scrape(url, cve_id):
    response = requests.get(url+cve_id)
    if response.status_code == 200:
        soup = BeautifulSoup(response.text, 'html.parser')

        # Check for CVE ID Not Found
        if soup.find('div', {'id': 'ErrorPanel'}):
            cve_data = {
                'error': f"{cve_id} Not Found"
            }
            return cve_data

        # Extract the vulnerability description
        description = soup.find('p', {'data-testid': 'vuln-description'}).text.strip()
        cvss_score = soup.find('a', {'data-testid': 'vuln-cvss3-panel-score'}).text.strip()
        cvss_color = cvss_color_calc(cvss_score)

        cve_data = {
            'id': cve_id.upper(),
            'description': description,
            'cvss_score': cvss_score,
            'cvss_color': cvss_color
        }
    else:
        cve_data = {
            'error': 'Failed to retrieve CVE data. Status code: {}'.format(response.status_code)
        }
    
    return cve_data