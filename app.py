from flask import Flask, request, render_template
from scraper import scrape_nvd, scrape_cveorg, scrape_cvedetails
from helpers import is_valid_cve

app = Flask(__name__)

"""
A function that serves as the route handler for the root URL ("/").
It renders the "index.html" template and returns the rendered HTML as a response.
Returns:
    str: The rendered HTML as a response.
"""
@app.route('/')
def home():
    return render_template('index.html')


@app.route('/cve', methods=['POST'])
def cve_checker():
    cve_id = request.form['cve_id']

    # Check for cve_id regex
    cve_passed_regex = is_valid_cve(cve_id)

    if(cve_passed_regex):
        nvd_data = scrape_nvd(cve_id)
        cveorg_data = scrape_cveorg(cve_id)
        cvedetails_data = scrape_cvedetails(cve_id)

        # Flatten the dictionaries by updating one with the other
        cve_data = {**nvd_data, **cveorg_data, **cvedetails_data}

        return render_template('searchresult.html', cve_data=cve_data)
    else:
        return render_template('searchresult.html', cve_data={'error': 'CVE not found or wrong CVE format'})


if __name__ == '__main__':
    app.run(debug=True)
